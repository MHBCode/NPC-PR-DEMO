<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>NPC Demo</title>

  <style>
    :root{
      --bg:#0b0f14;
      --card:#0f172a;
      --card2:#0b1220;
      --border:rgba(255,255,255,.10);
      --text:#e5e7eb;
      --muted:#9ca3af;
      --accent:#8a1538;
      --accent2:#b01f49;
      --shadow: 0 18px 50px rgba(0,0,0,.45);
      --radius:16px;
      --radius2:12px;
    }

    *{ box-sizing:border-box; }
    body{
      margin:0;
      font-family: "Segoe UI", Tahoma, Arial, sans-serif;
      background:
        radial-gradient(1200px 700px at 80% -20%, rgba(138,21,56,.25), transparent 60%),
        radial-gradient(900px 600px at -10% 40%, rgba(176,31,73,.18), transparent 55%),
        var(--bg);
      color:var(--text);
    }

    .wrap{
      max-width: 1200px;
      margin: 0 auto;
      padding: 20px;
    }

    .topbar{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:14px;
      padding: 14px 16px;
      background: rgba(255,255,255,.04);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      backdrop-filter: blur(10px);
    }

    .brand{
      display:flex;
      align-items:center;
      gap:12px;
      min-width: 260px;
    }

    .brand img{
      height:34px;
      width:auto;
      display:block;
      filter: drop-shadow(0 6px 16px rgba(0,0,0,.35));
    }

    .brand .title{
      display:flex;
      flex-direction:column;
      gap:2px;
      line-height:1.2;
    }
    .brand .title b{ font-size: 15px; }
    .brand .title span{ font-size: 12px; color: var(--muted); }

    .controls{
      display:flex;
      align-items:center;
      gap:10px;
      flex-wrap: wrap;
      justify-content:flex-end;
    }

    .btn{
      cursor:pointer;
      border: 1px solid var(--border);
      background: rgba(255,255,255,.06);
      color: var(--text);
      border-radius: 12px;
      padding: 10px 12px;
      font-weight: 600;
      font-size: 13px;
      transition: .15s ease;
      user-select:none;
    }
    .btn:hover{ transform: translateY(-1px); border-color: rgba(255,255,255,.18); }
    .btn:active{ transform: translateY(0px); }

    .btn.primary{
      background: linear-gradient(135deg, var(--accent), var(--accent2));
      border-color: rgba(255,255,255,.12);
    }

    .toggle{
      display:flex;
      align-items:center;
      gap:8px;
      padding: 10px 12px;
      border: 1px solid var(--border);
      border-radius: 12px;
      background: rgba(255,255,255,.04);
      font-size: 13px;
      color: var(--muted);
      user-select:none;
    }
    .toggle input{ accent-color: var(--accent2); }

    .grid{
      margin-top: 16px;
      display:grid;
      grid-template-columns: 1.3fr .7fr;
      gap: 14px;
    }

    @media (max-width: 980px){
      .grid{ grid-template-columns: 1fr; }
      .brand{ min-width: unset; }
    }

    .playerCard{
      background: rgba(255,255,255,.04);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      overflow:hidden;
    }

    .nowPlaying{
      padding: 14px 16px;
      border-bottom: 1px solid var(--border);
      display:flex;
      align-items:flex-start;
      justify-content:space-between;
      gap:12px;
      background: linear-gradient(180deg, rgba(255,255,255,.02), rgba(255,255,255,.00));
    }

    .nowPlaying .npText{
      display:flex;
      flex-direction:column;
      gap:4px;
      min-width: 0;
    }

    .badge{
      display:inline-flex;
      align-items:center;
      gap:8px;
      color: var(--muted);
      font-size: 12px;
    }

    .badge .dot{
      width:8px; height:8px;
      border-radius:99px;
      background: var(--accent2);
      box-shadow: 0 0 0 4px rgba(176,31,73,.18);
    }

    .npTitle{
      font-size: 16px;
      font-weight: 800;
      letter-spacing: .2px;
      white-space: nowrap;
      overflow:hidden;
      text-overflow: ellipsis;
    }

    .npMeta{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      color: var(--muted);
      font-size: 12px;
    }

    .videoBox{
      background: #000;
      position: relative;
    }

    video{
      width:100%;
      height:auto;
      display:block;
      background:#000;
    }

    .hint{
      padding: 10px 16px 14px;
      color: var(--muted);
      font-size: 12px;
      border-top: 1px solid var(--border);
      background: rgba(0,0,0,.12);
    }

    .listCard{
      background: rgba(255,255,255,.04);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      overflow:hidden;
      display:flex;
      flex-direction:column;
      min-height: 200px;
    }

    .listHead{
      padding: 14px 16px;
      border-bottom: 1px solid var(--border);
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:12px;
    }

    .listHead b{ font-size: 14px; }
    .listHead span{ color: var(--muted); font-size: 12px; }

    .list{
      padding: 8px;
      overflow:auto;
      max-height: 520px;
    }

    .item{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      padding: 10px 12px;
      border-radius: var(--radius2);
      border: 1px solid transparent;
      cursor:pointer;
      transition: .12s ease;
    }
    .item:hover{
      background: rgba(255,255,255,.05);
      border-color: rgba(255,255,255,.10);
    }
    .item.active{
      background: rgba(176,31,73,.18);
      border-color: rgba(176,31,73,.45);
    }

    .item .left{
      display:flex;
      align-items:center;
      gap:10px;
      min-width:0;
    }

    .pill{
      min-width: 32px;
      height: 28px;
      padding: 0 10px;
      border-radius: 999px;
      display:flex;
      align-items:center;
      justify-content:center;
      font-weight: 800;
      font-size: 12px;
      background: rgba(255,255,255,.07);
      border: 1px solid rgba(255,255,255,.10);
      color: var(--text);
      flex: 0 0 auto;
    }

    .item.active .pill{
      background: linear-gradient(135deg, var(--accent), var(--accent2));
      border-color: rgba(255,255,255,.14);
    }

    .item .name{
      font-size: 13px;
      font-weight: 700;
      white-space: nowrap;
      overflow:hidden;
      text-overflow: ellipsis;
    }

    .item .right{
      color: var(--muted);
      font-size: 12px;
      flex: 0 0 auto;
    }

    .footer{
      margin-top: 14px;
      text-align:center;
      color: var(--muted);
      font-size: 12px;
      opacity: .9;
    }
  </style>
</head>

<body>
  <div class="wrap">
    <div class="topbar">
      <div class="brand">
        <!-- Put npc-site-logo.png in the same folder -->
        <img src="logo.png" alt="NPC Logo" />
        <div class="title">
          <b>عرض توضيحي لمراحل العمل</b>
        </div>
      </div>

      <div class="controls">
        <button class="btn" id="btnPrev">السابق</button>
        <button class="btn primary" id="btnPlayPause">تشغيل</button>
        <button class="btn" id="btnNext">التالي</button>
        <label class="toggle" title="تشغيل المقطع التالي تلقائياً عند الانتهاء">
          <input type="checkbox" id="chkAutoNext" checked />
          الانتقال التلقائي
        </label>
        <label class="toggle" title="تشغيل بدون صوت (يساعد على السماح بالتشغيل التلقائي في المتصفح)">
          <input type="checkbox" id="chkMuted" checked />
          كتم الصوت
        </label>
      </div>
    </div>

    <div class="grid">
      <div class="playerCard">
        <div class="nowPlaying">
          <div class="npText">
            <div class="badge"><span class="dot"></span><span id="npStep">الجزء 1 / 11</span></div>
            <div class="npTitle" id="npTitle">—</div>
            <div class="npMeta">
              <span id="npFile">ملف: 1.mp4</span>
              <span>•</span>
              <span id="npStatus">جاهز</span>
            </div>
          </div>
        </div>

        <div class="videoBox">
          <!-- Put videos (1.mp4 ... 11.mp4) in the same folder as this HTML -->
          <video id="player" controls playsinline preload="metadata"></video>
        </div>

        <div class="hint" id="hint">
          إذا منع المتصفح التشغيل التلقائي: اضغط "تشغيل" مرة واحدة (مع تفعيل "كتم الصوت" غالباً ينجح التشغيل التلقائي).
        </div>
      </div>

      <div class="listCard">
        <div class="listHead">
          <b>قائمة المقاطع</b>
          <span id="listCount">11 مقطع</span>
        </div>
        <div class="list" id="list"></div>
      </div>
    </div>

    <div class="footer">
        Provided by Newtecx.
    </div>
  </div>

  <script>
    // ==========================
    // Playlist (titles + files)
    // ==========================
    const playlist = [
      { id: 1, title: "إرسال المحتوى إلى العلاقات العامة", file: "1.mp4" },
      { id: 2, title: "مراجعة الطلب وتوزيع المهام", file: "2.mp4" },
      { id: 3, title: "الإعداد المبدئي", file: "3.mp4" },
      { id: 4, title: "مراجعة مخرجات العمل", file: "4.mp4" },
      { id: 5, title: "مراجعه مدير الإدارة الطالبة", file: "5.mp4" },
      { id: 6, title: "اعتماد النسخة النهائية", file: "6.mp4" },
      { id: 7, title: "إرسال الطلب لمساعد الأمين العام لشؤون المجلس", file: "7.mp4" },
      { id: 8, title: "مراجعة مساعد الأمين العام لشؤون المجلس", file: "8.mp4" },
      { id: 9, title: "مراجعة مكتب سعادة الأمين العام لشؤون المجلس", file: "9.mp4" },
      { id: 10, title: "النشر على المنصات الرسمية", file: "10.mp4" },
      { id: 11, title: "التحقق بعد النشر", file: "11.mp4" }
    ];

    // ==========================
    // Elements
    // ==========================
    const player = document.getElementById("player");
    const listEl = document.getElementById("list");

    const npStep = document.getElementById("npStep");
    const npTitle = document.getElementById("npTitle");
    const npFile = document.getElementById("npFile");
    const npStatus = document.getElementById("npStatus");

    const btnPrev = document.getElementById("btnPrev");
    const btnNext = document.getElementById("btnNext");
    const btnPlayPause = document.getElementById("btnPlayPause");

    const chkAutoNext = document.getElementById("chkAutoNext");
    const chkMuted = document.getElementById("chkMuted");

    // ==========================
    // State
    // ==========================
    let currentIndex = 0;

    // Ensure muted helps autoplay policies
    player.muted = true;
    player.playsInline = true;

    function renderList(){
      listEl.innerHTML = "";
      playlist.forEach((item, idx) => {
        const row = document.createElement("div");
        row.className = "item" + (idx === currentIndex ? " active" : "");
        row.dataset.index = String(idx);

        row.innerHTML = `
          <div class="left">
            <div class="pill">${item.id}</div>
            <div class="name" title="${escapeHtml(item.title)}">${escapeHtml(item.title)}</div>
          </div>
          <div class="right">${escapeHtml(item.file)}</div>
        `;

        row.addEventListener("click", () => loadIndex(idx, true));
        listEl.appendChild(row);
      });
    }

    function updateNowPlaying(statusText){
      const item = playlist[currentIndex];
      npStep.textContent = `الجزء ${currentIndex + 1} / ${playlist.length}`;
      npTitle.textContent = item.title;
      npFile.textContent = `ملف: ${item.file}`;
      npStatus.textContent = statusText || "جاهز";
      highlightActive();
    }

    function highlightActive(){
      const items = listEl.querySelectorAll(".item");
      items.forEach((el) => el.classList.remove("active"));
      const active = listEl.querySelector(`.item[data-index="${currentIndex}"]`);
      if (active) {
        active.classList.add("active");
        // Keep the active item visible
        active.scrollIntoView({ block: "nearest" });
      }
    }

    function setPlayPauseLabel(){
      btnPlayPause.textContent = player.paused ? "تشغيل" : "إيقاف مؤقت";
    }

    async function safePlay(){
      try {
        await player.play();
        updateNowPlaying("يتم التشغيل");
      } catch (e) {
        // Autoplay might be blocked; user can click Play.
        updateNowPlaying("بانتظار التشغيل");
      }
      setPlayPauseLabel();
    }

    function loadIndex(idx, autoPlay){
      if (idx < 0) idx = 0;
      if (idx >= playlist.length) idx = playlist.length - 1;

      currentIndex = idx;
      const item = playlist[currentIndex];

      // Apply mute preference before loading
      player.muted = !!chkMuted.checked;

      // Set src
      player.src = item.file;
      player.load();

      updateNowPlaying("جاهز");

      if (autoPlay) safePlay();
      else setPlayPauseLabel();
    }

    function next(autoPlay=true){
      if (currentIndex < playlist.length - 1){
        loadIndex(currentIndex + 1, autoPlay);
      } else {
        updateNowPlaying("انتهت القائمة");
        setPlayPauseLabel();
      }
    }

    function prev(autoPlay=true){
      if (currentIndex > 0){
        loadIndex(currentIndex - 1, autoPlay);
      } else {
        loadIndex(0, autoPlay);
      }
    }

    // ==========================
    // Events
    // ==========================
    btnNext.addEventListener("click", () => next(true));
    btnPrev.addEventListener("click", () => prev(true));

    btnPlayPause.addEventListener("click", async () => {
      if (player.paused) {
        await safePlay();
      } else {
        player.pause();
        updateNowPlaying("متوقف مؤقتاً");
        setPlayPauseLabel();
      }
    });

    chkMuted.addEventListener("change", () => {
      player.muted = !!chkMuted.checked;
    });

    player.addEventListener("play", () => {
      updateNowPlaying("يتم التشغيل");
      setPlayPauseLabel();
    });
    player.addEventListener("pause", () => {
      // Avoid overriding "ended" text
      if (player.ended) return;
      updateNowPlaying("متوقف مؤقتاً");
      setPlayPauseLabel();
    });
    player.addEventListener("ended", () => {
      updateNowPlaying("انتهى المقطع");
      setPlayPauseLabel();
      if (chkAutoNext.checked) next(true);
    });

    // Keyboard shortcuts (optional)
    document.addEventListener("keydown", (e) => {
      if (e.target && (e.target.tagName === "INPUT" || e.target.tagName === "TEXTAREA")) return;
      if (e.code === "ArrowRight") prev(true);       // RTL: right = previous
      if (e.code === "ArrowLeft") next(true);        // RTL: left = next
      if (e.code === "Space") {
        e.preventDefault();
        btnPlayPause.click();
      }
    });

    // ==========================
    // Utils
    // ==========================
    function escapeHtml(str){
      return String(str)
        .replaceAll("&", "&amp;")
        .replaceAll("<", "&lt;")
        .replaceAll(">", "&gt;")
        .replaceAll('"', "&quot;")
        .replaceAll("'", "&#039;");
    }

    // ==========================
    // Init
    // ==========================
    document.getElementById("listCount").textContent = `${playlist.length} مقطع`;
    renderList();
    loadIndex(0, false);
    setPlayPauseLabel();

    // Try autoplay muted on load (often allowed)
    safePlay();
  </script>
</body>
</html>
